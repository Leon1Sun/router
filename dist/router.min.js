!function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();window.Router=function(){var t=function(){var t=void 0;return function(e){return e&&(t=e),t}}(),e=function(){var t=void 0;return function(e){return e&&(t=e),t}}(),r=function t(e,i){n(this,t),this.template=e||"",this.script=i||""},o=function(){function t(){n(this,t),this.keys=[],this.configs=[]}return i(t,[{key:"get",value:function(t){var e=this.keys.indexOf(t);return e>=0?this.configs[e]:void 0}},{key:"set",value:function(t,e){if(!e instanceof r)return console.warn("config is not instanceof RouteConfig"),!1;var n=this.keys.indexOf(t);n>0?this.configs[n]=e:(this.keys.push(t),this.configs.push(e))}},{key:"contains",value:function(t){return this.keys.indexOf(t)>=0}}]),t}(),s=function(){function e(i){var s=this;if(n(this,e),t())return t();var a=function(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rt-view";if(document.evaluate){if(t=document.evaluate("//*[@"+n+"]",document),e=t.iterateNext())return e;throw"can't find rt-view"}if(document.selectNodes){if(t=document.selectNodes("//*[@rt-view]"),!t||!t.length||t.length<=0)throw"can't find rt-view";return t[0]}};this.body=document.getElementsByTagName("BODY")[0],this.tagName=i,this.rootEle=a(i),this.scriptManager={},this.routerMap=new o,this.routerMap.contains("")||this.routerMap.set("",new r(this.rootEle.innerHTML,"")),this.oldHash=location.hash.replace("#",""),function(){window.onhashchange=function(t){console.log(location.hash),s.$$refreshView(location.hash)},console.debug("bind success")}(),t(this)}return i(e,[{key:"$$refreshView",value:function(t,e){if(t=t.replace("#",""),this.routerMap.contains(t)&&(this.rootEle.innerHTML=this.routerMap.get(t).template,this.oldHash=t,this.$$clearScript(t),this.$$evalScript(t),!e)){var n=this.routerMap.get(this.oldHash);n.template=this.rootEle.innerHTML}}},{key:"$$clearScript",value:function(t){for(var e in this.scriptManager)if(e!=t){var n=document.getElementById("s_"+e);n&&this.body.removeChild(n)}}},{key:"$$evalScript",value:function(t){console.debug("eval script of anchor "+t);try{var e=this.routerMap.get(t),n=e.script||"",i=document.createElement("script");i.id="s_"+t,i.type="text/javascript",i.innerHTML=n,this.body.appendChild(i),this.scriptManager[t]=n}catch(t){throw t}}},{key:"$$when",value:function(t,e,n){this.routerMap.set(t,new r(e,n)),""!=location.hash&&this.$$refreshView(location.hash,!0)}}]),e}(),a=function t(i){if(n(this,t),e())return e();var r=new s(i),o=function(t){return new Promise(function(e,n){var i,r=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveObject("Micrsorf.XMLHttp")}();r.onreadystatechange=function(){switch(r.readyState){case 3:console.log(3,"正在接受部分响应....."),i=r.responseText;break;case 4:r.status>=200&&r.status<300||304==r.status?e(i):n()}},r.open("get",t),r.send(null)})};this.$when=function(t,e,n){return r.$$when(t,e,n)},this.$whenUrl=function(t,e,n){var i,s;Promise.all([o(e),o(n)]).then(function(e){i=e[0],s=e[1],r.$$when(t,i,s)})},this.$hash=r.tagName,e(this)};return a}()}]);